# MOBS2 ‚Äì Painel de Acompanhamento de Ve√≠culos

## Descri√ß√£o

O MOBS2 √© uma aplica√ß√£o completa para visualiza√ß√£o de ve√≠culos em tempo real com dados de telemetria e hist√≥rico de posi√ß√µes. Ela √© composta por:

- **Backend Laravel**: cadastro de ve√≠culos e autentica√ß√£o via JWT.
- **Backend NestJS**: fornece telemetria simulada dos ve√≠culos a cada 5 segundos.
- **Frontend Vue 3 (Composition API + TypeScript + Sass)**: painel de acompanhamento com Google Maps.
- **Banco de dados**: PostgreSQL (ou SQL Server).
- **Docker**: todos os servi√ßos podem ser executados via cont√™ineres para facilitar instala√ß√£o e consist√™ncia de ambiente.

## Funcionalidades

### Laravel

- CRUD de ve√≠culos (placa, modelo, fabricante, ano).
- Autentica√ß√£o de usu√°rios via JWT.
- Apenas usu√°rios autenticados podem acessar os endpoints de cadastro.
- Implementa testes unit√°rios b√°sicos.

### NestJS

- Simula posi√ß√µes de ve√≠culos a cada 5 segundos (latitude, longitude, velocidade, combust√≠vel).
- WebSocket para atualiza√ß√£o em tempo real (diferencial).
- Implementa testes unit√°rios b√°sicos.

### Vue 3 (Frontend)

- Login e registro de usu√°rios.
- Visualiza√ß√£o de ve√≠culos no Google Maps.

  - Placa, velocidade, combust√≠vel, hora da √∫ltima atualiza√ß√£o.
  - Popup com detalhes ao clicar em um marcador.
  - Polilinha com hist√≥rico de posi√ß√µes.

- Busca por placa.
- Bot√£o para mostrar/ocultar hist√≥rico.

## Configura√ß√£o de Ambiente

### Laravel (.env)

```env
APP_NAME=Laravel
APP_ENV=local
APP_KEY=base64:SUA_CHAVE_AQUI=
APP_DEBUG=true
APP_TIMEZONE=UTC
APP_URL=http://localhost:8000

DB_CONNECTION=pgsql
DB_HOST=db
DB_PORT=5432
DB_DATABASE=mobs
DB_USERNAME=postgres
DB_PASSWORD=secret

JWT_SECRET=GERAR_USANDO_O_COMANDO_ARTISAN_JWT:SECRET
```

### NestJS (.env)

```env
LARAVEL_API_URL=http://web
```

### Frontend Vue 3 (.env)

```env
VITE_GOOGLE_MAPS_API_KEY=YOUR_GOOGLE_MAPS_API_KEY
```

# Iniciando o projeto üöÄ

## Execu√ß√£o via Docker

1. Certifique-se de que o Docker e Docker Compose est√£o instalados.
2. Configure os arquivos `.env` para Laravel, NestJS e Frontend conforme acima.
3. Execute:

```bash
docker-compose up --build
```

## Criando as Tabelas (Laravel)

Ap√≥s subir os containers com Docker, rode o seguinte comando no seu terminal pra configurar seu Laravel:

```bash
docker-compose exec app php artisan key:generate
docker-compose exec app php artisan jwt:secret
docker-compose exec app php artisan migrate
```

e pronto, aplica√ß√£o no docker, APP_KEY gerado, JWT gerado e tabelas criadas!

4. O frontend estar√° dispon√≠vel em `http://localhost:5173`.
5. Laravel em `http://localhost:8000`.
6. NestJS em `http://localhost:3000`.

## Observa√ß√µes

- Todos os servi√ßos dependem de que as APIs estejam dispon√≠veis antes de iniciar o frontend.
- O Google Maps s√≥ ser√° carregado se a chave de API estiver configurada.
- A aplica√ß√£o possui verifica√ß√£o de status das APIs e exibe mensagens de loading enquanto espera os servi√ßos estarem prontos.

## Documenta√ß√£o das APIs

### Laravel

A documenta√ß√£o detalhada do Laravel est√° dispon√≠vel via Swagger na url:

```
http://localhost:8000/api/documentation
```

### NestJS

A rota principal para obter telemetria √©:

```
GET http://localhost:3000/telemetry/{placa-do-carro}
```

Essa rota espera receber o **Bearer token** do usu√°rio autenticado via Laravel e retorna os dados de telemetria do ve√≠culo correspondente.

### Testes

Observa√ß√£o:o teste deve ser rodado dentro do docker pra poder ter acesso ao banco de dados!
Para rodar os testes do Laravel, use o comando:

```
docker-compose exec app php artisan test
```

Para rodar os testes do Nest:

```
cd ./telemetry
```

use o comando:

```
npm run test
```

‚ùóOs testes do Frontend n√£o foram finalizados! Mas est√£o presentes ( inacabados ) na pasta de tests!

### Observa√ß√µes

Se restar alguma d√∫vida em rela√ß√£o ao c√≥digo do NestJS, d√™ uma olhada neste outro projeto onde o foco era somente NestJS, e nele consegui implementar todas as funcionalidades necess√°rias:
[transactions-api](https://github.com/JoaumVictor/transactions-api)

Se restar d√∫vida em rela√ß√£o √† qualidade do meu frontend, pode ver este outro projeto meu que j√° est√° em produ√ß√£o, uma livraria online:
[Editor Balaozinho](https://www.editorabalaozinho.com/pt-BR)

Em rela√ß√£o ao Laravel, foi onde mais passei meu tempo, pois nunca tinha usado essa tecnologia. Foram 4 dias alternando entre vers√µes do Laravel, resolvendo erro de CORS, erro na gera√ß√£o das migrations, erro na gera√ß√£o do Swagger, permiss√µes que o Laravel exigia e que eu n√£o fazia ideia. Foi onde mais quebrei a cabe√ßa!
